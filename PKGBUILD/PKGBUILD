# Maintainer: David Torralba Goitia <david.torralba.goitia@gmail.com>

_name=direnv-backup
pkgname="${_name}-git"
# TODO: pick version from pyproject.toml
pkgver=0.0.1
pkgrel=1
# TODO: pick description from pyproject.toml
pkgdesc="Tool to backup/restore direnv files with optional encryption"
arch=("any")
url="https://github.com/dtgoitia/${_name}"
# source=("https://github.com/dtgoitia/${_name}.git")
source=("${_name}-${pkgver}::git+https://github.com/dtgoitia/${_name}.git")
# source=("direnv_backup_sources::git+https://github.com/dtgoitia/direnv-backup.git?signed#tag=${pkgver}")

provides=($_name)
conflicts=($_name "${_name}-git" "${_name}-bin")
license=("GLP3")
depends=("python")
makedepends=("git" "python-build" "python-installer" "python-wheel")

build () {
    cd "${srcdir}/${_name}-${pkgver}"
    python -m build --wheel --outdir $srcdir
}

package() {
    wheel_file="$(find . -type f -name '*.whl')"
    
    if [[ ! -f "${wheel_file}" ]]; then
        echo "Could not find the wheel package" 1>&2
        exit 1
    fi

    python -m installer --destdir="$pkgdir" "${wheel_file}"
}
sha256sums=('SKIP')
